
function Array2Object(array) {
    if (!Array.isArray(array)) return {};
    return array.reduce(function setValue(r, i) {
        r[i.key] = i.value;
        return r;
    }, {});
};

function parseAttachments(attachments, type) {
    if (typeof attachments == 'object' && !Array.isArray(attachments)) attachments = [attachments];
    if (!Array.isArray(attachments)) return '';
    return attachments.map(function buildID(a) {
        if (typeof a.type !== 'string') {
            return (type || '') + a.owner_id + '_' + a.id + (a.access_key ? '_' + a.access_key : '');
        }
        var e = a[a.type];
        if (a.type == 'sticker') return 'sticker_' + e.id;
        return a.type + e.owner_id + '_' + e.id + (e.access_key ? '_' + e.access_key : '');
    }).join(',');
};

function getAttachmentUrl(attachment) {
    if (typeof attachment !== 'object') return '';
    var a = attachment.type ? attachment[attachment.type] : attachment;
    return a.photo_2560 || a.photo_1280 ||
        a.photo_807 || a.photo_800 ||
        a.photo_640 || a.photo_604 ||
        a.photo_512 || a.photo_352 ||
        a.photo_320 || a.thumb_256 ||
        a.photo_256 || a.photo_200 ||
        a.photo_128 || a.photo_130 ||
        a.photo_100 || a.thumb_96  ||
        a.photo_75  || a.photo_64  ||
        a.photo_50  || a.thumb_48  ||
        a.src       || a.url       || '';
};

module.exports = {
    Array2Object: Array2Object,
    parseAttachments: parseAttachments,
    getAttachmentUrl: getAttachmentUrl,
};
